/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => OllamaPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian4 = require("obsidian");

// src/services/OllamaService.ts
var OllamaService = class {
  constructor(settings) {
    this.settings = settings;
  }
  async generateResponse(prompt, onChunk) {
    var _a;
    try {
      const response = await fetch(`${this.settings.ollamaUrl}/api/generate`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          "model": this.settings.modelName,
          "prompt": prompt,
          "stream": true
        })
      });
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const reader = (_a = response.body) == null ? void 0 : _a.getReader();
      if (!reader) {
        throw new Error("Response body is not readable");
      }
      const decoder = new TextDecoder();
      while (true) {
        const { done, value } = await reader.read();
        if (done)
          break;
        const chunk = decoder.decode(value);
        const lines = chunk.split("\n");
        for (const line of lines) {
          if (line.trim() === "")
            continue;
          try {
            const parsed = JSON.parse(line);
            if (parsed.response) {
              onChunk(parsed.response);
            }
          } catch (e) {
            console.error("Error parsing JSON:", e);
          }
        }
      }
    } catch (error) {
      console.error("Error generating Ollama response:", error);
      onChunk(`Error: Failed to generate response from Ollama. Details: ${error.message}`);
    }
  }
  async fetchModels() {
    try {
      const response = await fetch(`${this.settings.ollamaUrl}/api/tags`);
      if (!response.ok) {
        throw new Error("Failed to fetch models");
      }
      const data = await response.json();
      return data.models.map((model) => model.name);
    } catch (error) {
      console.error("Error fetching Ollama models:", error);
      return [];
    }
  }
};

// src/models/OllamaPluginSettings.ts
var DEFAULT_SETTINGS = {
  ollamaUrl: "http://localhost:11434",
  modelName: "llama3.1"
};

// src/OllamaSuggestor.ts
var import_obsidian = require("obsidian");
var OllamaSuggestor = class extends import_obsidian.EditorSuggest {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onTrigger(cursor, editor, file) {
    const line = editor.getLine(cursor.line).slice(0, cursor.ch);
    if (line.endsWith("/")) {
      return {
        start: { line: cursor.line, ch: cursor.ch - 1 },
        end: cursor,
        query: "/"
      };
    }
    return null;
  }
  getSuggestions(context) {
    return ["ollama"];
  }
  renderSuggestion(suggestion, el) {
    el.setText(suggestion);
  }
  selectSuggestion(suggestion) {
    const editor = this.context.editor;
    const cursor = editor.getCursor();
    editor.replaceRange(suggestion + " ", { line: cursor.line, ch: cursor.ch - 1 }, cursor);
  }
};

// src/OllamaPromptModal.ts
var import_obsidian2 = require("obsidian");
var OllamaPromptModal = class extends import_obsidian2.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h2", { text: "Ollama Prompt" });
    this.promptInput = contentEl.createEl("textarea", {
      attr: { rows: "4", cols: "50", placeholder: "Enter your prompt here" }
    });
    contentEl.createEl("br");
    const generateButton = contentEl.createEl("button", {
      text: "Generate Response",
      attr: { style: "margin-top: 10px; margin-bottom: 10px;" }
    });
    generateButton.addEventListener("click", this.generateResponse.bind(this));
    this.responseOutput = contentEl.createEl("div", { cls: "ollama-response" });
  }
  async generateResponse() {
    const prompt = this.promptInput.value;
    if (prompt) {
      this.responseOutput.setText("");
      await this.plugin.generateOllamaResponse(prompt, (chunk) => {
        this.responseOutput.setText(this.responseOutput.textContent + chunk);
      });
    }
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/OllamaSettingTab.ts
var import_obsidian3 = require("obsidian");
var OllamaSettingTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  async display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian3.Setting(containerEl).setName("Ollama URL").setDesc("The URL of your local Ollama instance").addText((text) => text.setPlaceholder("Enter the Ollama URL").setValue(this.plugin.settings.ollamaUrl).onChange(async (value) => {
      this.plugin.settings.ollamaUrl = value;
      await this.plugin.saveSettings();
      this.updateModelDropdown();
    }));
    const modelSetting = new import_obsidian3.Setting(containerEl).setName("Model Name").setDesc("The name of the Ollama model to use");
    modelSetting.addDropdown(async (dropdown) => {
      this.modelDropdown = dropdown;
      const models = await this.plugin.fetchOllamaModels();
      models.forEach((model) => {
        dropdown.addOption(model, model);
      });
      dropdown.setValue(this.plugin.settings.modelName);
      dropdown.onChange(async (value) => {
        this.plugin.settings.modelName = value;
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian3.Setting(containerEl).setName("Refresh Models").setDesc("Fetch the latest list of models from Ollama").addButton((button) => {
      button.setButtonText("Refresh").onClick(async () => {
        await this.updateModelDropdown();
        new import_obsidian3.Notice("Models refreshed");
      });
    });
  }
  async updateModelDropdown() {
    const models = await this.plugin.fetchOllamaModels();
    this.modelDropdown.clear();
    models.forEach((model) => {
      this.modelDropdown.addOption(model, model);
    });
    if (models.includes(this.plugin.settings.modelName)) {
      this.modelDropdown.setValue(this.plugin.settings.modelName);
    } else if (models.length > 0) {
      this.plugin.settings.modelName = models[0];
      await this.plugin.saveSettings();
    }
    this.modelDropdown.onChange(async (value) => {
      this.plugin.settings.modelName = value;
      await this.plugin.saveSettings();
    });
  }
};

// main.ts
var OllamaPlugin = class extends import_obsidian4.Plugin {
  constructor() {
    super(...arguments);
    this.isProcessingCommand = false;
  }
  async onload() {
    await this.loadSettings();
    this.ollamaService = new OllamaService(this.settings);
    const ribbonIconEl = this.addRibbonIcon("star", "Ollama AI Integration", (evt) => {
      new OllamaPromptModal(this.app, this).open();
    });
    ribbonIconEl.addClass("ollama-plugin-ribbon-class");
    this.addCommand({
      id: "open-ollama-prompt-modal",
      name: "Open Ollama prompt modal",
      callback: () => {
        new OllamaPromptModal(this.app, this).open();
      }
    });
    this.addCommand({
      id: "process-ollama-inline-command",
      name: "Process /ollama command",
      editorCallback: (editor, view) => {
        console.log("[ollama command]");
        const cursor = editor.getCursor();
        let initialLine = editor.getLine(cursor.line - 1);
        const match = initialLine.match(/^ollama\s+(.+)$/);
        if (match && !this.isProcessingCommand) {
          initialLine = initialLine.replace(/^ollama\s+/, "");
          this.isProcessingCommand = true;
          this.processOllamaCommand(editor, initialLine).finally(() => {
            this.isProcessingCommand = false;
          });
        }
      }
    });
    this.suggestor = new OllamaSuggestor(this.app, this);
    this.registerEditorSuggest(this.suggestor);
    this.addCommand({
      id: "generate-ollama-response",
      name: "Generate Ollama response",
      editorCallback: (editor, view) => {
        const selection = editor.getSelection();
        if (selection) {
          this.generateOllamaResponse(selection, (response) => {
            editor.replaceSelection(response);
          });
        }
      }
    });
    this.addSettingTab(new OllamaSettingTab(this.app, this));
    this.registerDomEvent(document, "keydown", (evt) => {
      this.handleKeyPress(evt);
    });
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  handleKeyPress(evt) {
    if (evt.key === "Enter" && !this.isProcessingCommand) {
      const activeLeaf = this.app.workspace.activeLeaf;
      if (activeLeaf.view instanceof import_obsidian4.MarkdownView) {
        const editor = activeLeaf.view.editor;
        const cursor = editor.getCursor();
        let lastLine = editor.getLine(cursor.line - 1);
        let line = editor.getLine(cursor.line);
        let initialLine = lastLine.replace(/^ollama\s+/, "");
        console.log("isProcessingCommand:", lastLine, this.isProcessingCommand);
        if (lastLine.trim().startsWith("ollama ")) {
          evt.preventDefault();
          this.isProcessingCommand = true;
          this.processOllamaCommand(editor, initialLine).finally(() => {
            this.isProcessingCommand = false;
          });
        }
      }
    }
  }
  async generateOllamaResponse(prompt, onChunk) {
    await this.ollamaService.generateResponse(prompt, onChunk);
  }
  async processOllamaCommand(editor, raw_prompt) {
    const cursor = editor.getCursor();
    const prompt = raw_prompt;
    editor.setLine(cursor.line, "");
    editor.setCursor(cursor.line, 0);
    editor.replaceRange("\n", cursor);
    let response = "";
    const updateEditor = () => {
      editor.setValue(response);
      editor.scrollIntoView({ from: cursor, to: cursor }, true);
    };
    await this.ollamaService.generateResponse(prompt, (chunk) => {
      response += chunk;
      updateEditor();
    });
    updateEditor();
    editor.setCursor(cursor.line + 1 + response.split("\n").length - 1, 0);
    new import_obsidian4.Notice("Ollama response generated");
  }
  async fetchOllamaModels() {
    return this.ollamaService.fetchModels();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvc2VydmljZXMvT2xsYW1hU2VydmljZS50cyIsICJzcmMvbW9kZWxzL09sbGFtYVBsdWdpblNldHRpbmdzLnRzIiwgInNyYy9PbGxhbWFTdWdnZXN0b3IudHMiLCAic3JjL09sbGFtYVByb21wdE1vZGFsLnRzIiwgInNyYy9PbGxhbWFTZXR0aW5nVGFiLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQge1xuXHRFZGl0b3IsXG5cdE1hcmtkb3duVmlldyxcblx0Tm90aWNlLFxuXHRQbHVnaW4sXG59IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7T2xsYW1hU2VydmljZX0gZnJvbSBcIi4vc3JjL3NlcnZpY2VzL09sbGFtYVNlcnZpY2VcIjtcbmltcG9ydCB7REVGQVVMVF9TRVRUSU5HUywgT2xsYW1hUGx1Z2luU2V0dGluZ3N9IGZyb20gXCIuL3NyYy9tb2RlbHMvT2xsYW1hUGx1Z2luU2V0dGluZ3NcIjtcbmltcG9ydCB7T2xsYW1hU3VnZ2VzdG9yfSBmcm9tIFwiLi9zcmMvT2xsYW1hU3VnZ2VzdG9yXCI7XG5pbXBvcnQge09sbGFtYVByb21wdE1vZGFsfSBmcm9tIFwiLi9zcmMvT2xsYW1hUHJvbXB0TW9kYWxcIjtcbmltcG9ydCB7T2xsYW1hU2V0dGluZ1RhYn0gZnJvbSBcIi4vc3JjL09sbGFtYVNldHRpbmdUYWJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT2xsYW1hUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblx0c2V0dGluZ3M6IE9sbGFtYVBsdWdpblNldHRpbmdzO1xuXHRzdWdnZXN0b3I6IE9sbGFtYVN1Z2dlc3Rvcjtcblx0b2xsYW1hU2VydmljZTogT2xsYW1hU2VydmljZTtcblxuXHRwcml2YXRlIGlzUHJvY2Vzc2luZ0NvbW1hbmQgPSBmYWxzZTtcblxuXHRhc3luYyBvbmxvYWQoKSB7XG5cdFx0YXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblx0XHR0aGlzLm9sbGFtYVNlcnZpY2UgPSBuZXcgT2xsYW1hU2VydmljZSh0aGlzLnNldHRpbmdzKTtcblxuXHRcdC8vIFRoaXMgY3JlYXRlcyBhbiBpY29uIGluIHRoZSBsZWZ0IHJpYmJvbi5cblx0XHRjb25zdCByaWJib25JY29uRWwgPSB0aGlzLmFkZFJpYmJvbkljb24oJ3N0YXInLCAnT2xsYW1hIEFJIEludGVncmF0aW9uJywgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0bmV3IE9sbGFtYVByb21wdE1vZGFsKHRoaXMuYXBwLCB0aGlzKS5vcGVuKCk7XG5cdFx0fSk7XG5cdFx0cmliYm9uSWNvbkVsLmFkZENsYXNzKCdvbGxhbWEtcGx1Z2luLXJpYmJvbi1jbGFzcycpO1xuXG5cdFx0Ly8gVGhpcyBhZGRzIGEgc2ltcGxlIGNvbW1hbmQgdGhhdCBjYW4gYmUgdHJpZ2dlcmVkIGFueXdoZXJlXG5cdFx0dGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnb3Blbi1vbGxhbWEtcHJvbXB0LW1vZGFsJyxcblx0XHRcdG5hbWU6ICdPcGVuIE9sbGFtYSBwcm9tcHQgbW9kYWwnLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHtcblx0XHRcdFx0bmV3IE9sbGFtYVByb21wdE1vZGFsKHRoaXMuYXBwLCB0aGlzKS5vcGVuKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvLyBBZGQgdGhlIG5ldyBjb21tYW5kIGZvciAvb2xsYW1hIHN5bnRheFxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogJ3Byb2Nlc3Mtb2xsYW1hLWlubGluZS1jb21tYW5kJyxcblx0XHRcdG5hbWU6ICdQcm9jZXNzIC9vbGxhbWEgY29tbWFuZCcsXG5cdFx0XHRlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ1tvbGxhbWEgY29tbWFuZF0nKVxuXHRcdFx0XHRjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG5cdFx0XHRcdGxldCBpbml0aWFsTGluZSA9IGVkaXRvci5nZXRMaW5lKGN1cnNvci5saW5lIC0gMSk7XG5cdFx0XHRcdGNvbnN0IG1hdGNoID0gaW5pdGlhbExpbmUubWF0Y2goL15vbGxhbWFcXHMrKC4rKSQvKTtcblx0XHRcdFx0aWYgKG1hdGNoICYmICF0aGlzLmlzUHJvY2Vzc2luZ0NvbW1hbmQpIHtcblx0XHRcdFx0XHRpbml0aWFsTGluZSA9IGluaXRpYWxMaW5lLnJlcGxhY2UoL15vbGxhbWFcXHMrLywgJycpO1xuXHRcdFx0XHRcdHRoaXMuaXNQcm9jZXNzaW5nQ29tbWFuZCA9IHRydWU7XG5cdFx0XHRcdFx0dGhpcy5wcm9jZXNzT2xsYW1hQ29tbWFuZChlZGl0b3IsIGluaXRpYWxMaW5lKS5maW5hbGx5KCgpID0+IHtcblx0XHRcdFx0XHRcdHRoaXMuaXNQcm9jZXNzaW5nQ29tbWFuZCA9IGZhbHNlO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvLyBJbml0aWFsaXplIHRoZSBzdWdnZXN0b3Jcblx0XHR0aGlzLnN1Z2dlc3RvciA9IG5ldyBPbGxhbWFTdWdnZXN0b3IodGhpcy5hcHAsIHRoaXMpO1xuXHRcdHRoaXMucmVnaXN0ZXJFZGl0b3JTdWdnZXN0KHRoaXMuc3VnZ2VzdG9yKTtcblxuXHRcdC8vIFRoaXMgYWRkcyBhbiBlZGl0b3IgY29tbWFuZCB0aGF0IGNhbiBwZXJmb3JtIHNvbWUgb3BlcmF0aW9uIG9uIHRoZSBjdXJyZW50IGVkaXRvciBpbnN0YW5jZVxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogJ2dlbmVyYXRlLW9sbGFtYS1yZXNwb25zZScsXG5cdFx0XHRuYW1lOiAnR2VuZXJhdGUgT2xsYW1hIHJlc3BvbnNlJyxcblx0XHRcdGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdFx0XHRjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XG5cdFx0XHRcdGlmIChzZWxlY3Rpb24pIHtcblx0XHRcdFx0XHR0aGlzLmdlbmVyYXRlT2xsYW1hUmVzcG9uc2Uoc2VsZWN0aW9uLCAocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0XHRcdGVkaXRvci5yZXBsYWNlU2VsZWN0aW9uKHJlc3BvbnNlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gVGhpcyBhZGRzIGEgc2V0dGluZ3MgdGFiIHNvIHRoZSB1c2VyIGNhbiBjb25maWd1cmUgdmFyaW91cyBhc3BlY3RzIG9mIHRoZSBwbHVnaW5cblx0XHR0aGlzLmFkZFNldHRpbmdUYWIobmV3IE9sbGFtYVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuXHRcdC8vQWRkIGV2ZW50IGxpc3RlbmVyIGZvciBrZXlwcmVzcyBldmVudHNcblx0XHR0aGlzLnJlZ2lzdGVyRG9tRXZlbnQoZG9jdW1lbnQsICdrZXlkb3duJywgKGV2dDogS2V5Ym9hcmRFdmVudCkgPT4ge1xuXHRcdFx0dGhpcy5oYW5kbGVLZXlQcmVzcyhldnQpO1xuXHRcdH0pO1xuXHR9XG5cblx0b251bmxvYWQoKSB7fVxuXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcblx0fVxuXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcblx0XHRhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuXHR9XG5cblx0aGFuZGxlS2V5UHJlc3MoZXZ0OiBLZXlib2FyZEV2ZW50KSB7XG5cdFx0aWYgKGV2dC5rZXkgPT09ICdFbnRlcicgJiYgIXRoaXMuaXNQcm9jZXNzaW5nQ29tbWFuZCkge1xuXHRcdFx0Y29uc3QgYWN0aXZlTGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5hY3RpdmVMZWFmO1xuXHRcdFx0aWYgKGFjdGl2ZUxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldykge1xuXG5cdFx0XHRcdGNvbnN0IGVkaXRvciA9IGFjdGl2ZUxlYWYudmlldy5lZGl0b3I7XG5cdFx0XHRcdGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKTtcblx0XHRcdFx0bGV0IGxhc3RMaW5lID0gZWRpdG9yLmdldExpbmUoY3Vyc29yLmxpbmUgLSAxKTtcblx0XHRcdFx0bGV0IGxpbmUgPSBlZGl0b3IuZ2V0TGluZShjdXJzb3IubGluZSk7XG5cdFx0XHRcdGxldCBpbml0aWFsTGluZSA9IGxhc3RMaW5lLnJlcGxhY2UoL15vbGxhbWFcXHMrLywgJycpO1xuXHRcdFx0XHRjb25zb2xlLmxvZygnaXNQcm9jZXNzaW5nQ29tbWFuZDonLCBsYXN0TGluZSwgdGhpcy5pc1Byb2Nlc3NpbmdDb21tYW5kKTtcblx0XHRcdFx0aWYgKGxhc3RMaW5lLnRyaW0oKS5zdGFydHNXaXRoKCdvbGxhbWEgJykpIHtcblx0XHRcdFx0XHRldnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHR0aGlzLmlzUHJvY2Vzc2luZ0NvbW1hbmQgPSB0cnVlO1xuXHRcdFx0XHRcdHRoaXMucHJvY2Vzc09sbGFtYUNvbW1hbmQoZWRpdG9yLCBpbml0aWFsTGluZSkuZmluYWxseSgoKSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLmlzUHJvY2Vzc2luZ0NvbW1hbmQgPSBmYWxzZTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGFzeW5jIGdlbmVyYXRlT2xsYW1hUmVzcG9uc2UocHJvbXB0OiBzdHJpbmcsIG9uQ2h1bms6IChjaHVuazogc3RyaW5nKSA9PiB2b2lkKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0YXdhaXQgdGhpcy5vbGxhbWFTZXJ2aWNlLmdlbmVyYXRlUmVzcG9uc2UocHJvbXB0LCBvbkNodW5rKTtcblx0fVxuXG5cdGFzeW5jIHByb2Nlc3NPbGxhbWFDb21tYW5kKGVkaXRvcjogRWRpdG9yLCByYXdfcHJvbXB0OiBzdHJpbmcpIHtcblxuXHRcdGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKTtcblx0XHRcdGNvbnN0IHByb21wdCA9IHJhd19wcm9tcHQ7XG5cblx0XHRcdC8vIENsZWFyIHRoZSBjdXJyZW50IGxpbmVcblx0XHRcdGVkaXRvci5zZXRMaW5lKGN1cnNvci5saW5lLCAnJyk7XG5cblx0XHRcdC8vIE1vdmUgY3Vyc29yIHRvIHRoZSBlbmQgb2YgdGhlIGN1cnJlbnQgbGluZVxuXHRcdFx0ZWRpdG9yLnNldEN1cnNvcihjdXJzb3IubGluZSwgMCk7XG5cblx0XHRcdC8vIEluc2VydCBhIG5ldyBsaW5lIGZvciB0aGUgcmVzcG9uc2Vcblx0XHRcdGVkaXRvci5yZXBsYWNlUmFuZ2UoJ1xcbicsIGN1cnNvcik7XG5cblx0XHRcdGxldCByZXNwb25zZSA9ICcnO1xuXG5cdFx0XHRjb25zdCB1cGRhdGVFZGl0b3IgPSAoKSA9PiB7XG5cdFx0XHRcdC8vIGVkaXRvci5zZXRMaW5lKGN1cnNvci5saW5lICsgMSwgcmVzcG9uc2UpO1xuXHRcdFx0XHRlZGl0b3Iuc2V0VmFsdWUocmVzcG9uc2UpO1xuXHRcdFx0XHRlZGl0b3Iuc2Nyb2xsSW50b1ZpZXcoe2Zyb206IGN1cnNvciwgdG86IGN1cnNvcn0sIHRydWUpO1xuXHRcdFx0fTtcblxuXHRcdFx0IGF3YWl0IHRoaXMub2xsYW1hU2VydmljZS5nZW5lcmF0ZVJlc3BvbnNlKHByb21wdCwgKGNodW5rKSA9PiB7XG5cdFx0XHRcdHJlc3BvbnNlICs9IGNodW5rO1xuXHRcdFx0XHR1cGRhdGVFZGl0b3IoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR1cGRhdGVFZGl0b3IoKTtcblxuXHRcdFx0Ly8gTW92ZSB0aGUgY3Vyc29yIHRvIHRoZSBlbmQgb2YgdGhlIHJlc3BvbnNlXG5cdFx0XHRlZGl0b3Iuc2V0Q3Vyc29yKGN1cnNvci5saW5lICsgMSArIHJlc3BvbnNlLnNwbGl0KCdcXG4nKS5sZW5ndGggLSAxLCAwKTtcblxuXHRcdFx0bmV3IE5vdGljZSgnT2xsYW1hIHJlc3BvbnNlIGdlbmVyYXRlZCcpO1xuXHR9XG5cblx0YXN5bmMgZmV0Y2hPbGxhbWFNb2RlbHMoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuXHRcdHJldHVybiB0aGlzLm9sbGFtYVNlcnZpY2UuZmV0Y2hNb2RlbHMoKTtcblx0fVxuXG59XG4iLCAiaW1wb3J0IHsgT2xsYW1hUGx1Z2luU2V0dGluZ3MgfSBmcm9tICcuLi9tb2RlbHMvT2xsYW1hUGx1Z2luU2V0dGluZ3MnO1xuXG5leHBvcnQgY2xhc3MgT2xsYW1hU2VydmljZSB7XG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgc2V0dGluZ3M6IE9sbGFtYVBsdWdpblNldHRpbmdzKSB7fVxuXG5cdGFzeW5jIGdlbmVyYXRlUmVzcG9uc2UocHJvbXB0OiBzdHJpbmcsIG9uQ2h1bms6IChjaHVuazogc3RyaW5nKSA9PiB2b2lkKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5zZXR0aW5ncy5vbGxhbWFVcmx9L2FwaS9nZW5lcmF0ZWAsIHtcblx0XHRcdFx0bWV0aG9kOiAnUE9TVCcsXG5cdFx0XHRcdGhlYWRlcnM6IHtcblx0XHRcdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRib2R5OiBKU09OLnN0cmluZ2lmeSh7XG5cdFx0XHRcdFx0XCJtb2RlbFwiOiB0aGlzLnNldHRpbmdzLm1vZGVsTmFtZSxcblx0XHRcdFx0XHRcInByb21wdFwiOiBwcm9tcHQsXG5cdFx0XHRcdFx0XCJzdHJlYW1cIjogdHJ1ZSxcblx0XHRcdFx0fSksXG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKCFyZXNwb25zZS5vaykge1xuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3IhIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IHJlYWRlciA9IHJlc3BvbnNlLmJvZHk/LmdldFJlYWRlcigpO1xuXHRcdFx0aWYgKCFyZWFkZXIpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdSZXNwb25zZSBib2R5IGlzIG5vdCByZWFkYWJsZScpO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG5cdFx0XHR3aGlsZSAodHJ1ZSkge1xuXHRcdFx0XHRjb25zdCB7IGRvbmUsIHZhbHVlIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpO1xuXHRcdFx0XHRpZiAoZG9uZSkgYnJlYWs7XG5cblx0XHRcdFx0Y29uc3QgY2h1bmsgPSBkZWNvZGVyLmRlY29kZSh2YWx1ZSk7XG5cdFx0XHRcdGNvbnN0IGxpbmVzID0gY2h1bmsuc3BsaXQoJ1xcbicpO1xuXHRcdFx0XHRmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcblx0XHRcdFx0XHRpZiAobGluZS50cmltKCkgPT09ICcnKSBjb250aW51ZTtcblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0Y29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShsaW5lKTtcblx0XHRcdFx0XHRcdGlmIChwYXJzZWQucmVzcG9uc2UpIHtcblx0XHRcdFx0XHRcdFx0b25DaHVuayhwYXJzZWQucmVzcG9uc2UpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBhcnNpbmcgSlNPTjonLCBlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0Y29uc29sZS5lcnJvcignRXJyb3IgZ2VuZXJhdGluZyBPbGxhbWEgcmVzcG9uc2U6JywgZXJyb3IpO1xuXHRcdFx0b25DaHVuayhgRXJyb3I6IEZhaWxlZCB0byBnZW5lcmF0ZSByZXNwb25zZSBmcm9tIE9sbGFtYS4gRGV0YWlsczogJHtlcnJvci5tZXNzYWdlfWApO1xuXHRcdH1cblx0fVxuXG5cdGFzeW5jIGZldGNoTW9kZWxzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLnNldHRpbmdzLm9sbGFtYVVybH0vYXBpL3RhZ3NgKTtcblx0XHRcdGlmICghcmVzcG9uc2Uub2spIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggbW9kZWxzJyk7XG5cdFx0XHR9XG5cdFx0XHRjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXHRcdFx0cmV0dXJuIGRhdGEubW9kZWxzLm1hcCgobW9kZWw6IHsgbmFtZTogc3RyaW5nIH0pID0+IG1vZGVsLm5hbWUpO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBPbGxhbWEgbW9kZWxzOicsIGVycm9yKTtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cdH1cbn1cbiIsICJleHBvcnQgaW50ZXJmYWNlIE9sbGFtYVBsdWdpblNldHRpbmdzIHtcblx0b2xsYW1hVXJsOiBzdHJpbmc7XG5cdG1vZGVsTmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogT2xsYW1hUGx1Z2luU2V0dGluZ3MgPSB7XG5cdG9sbGFtYVVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQnLFxuXHRtb2RlbE5hbWU6ICdsbGFtYTMuMSdcbn07XG4iLCAiaW1wb3J0IHtcblx0QXBwLFxuXHRFZGl0b3IsXG5cdEVkaXRvclBvc2l0aW9uLFxuXHRFZGl0b3JTdWdnZXN0LFxuXHRFZGl0b3JTdWdnZXN0Q29udGV4dCxcblx0RWRpdG9yU3VnZ2VzdFRyaWdnZXJJbmZvLFxuXHRURmlsZVxufSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgT2xsYW1hUGx1Z2luIGZyb20gXCIuLi9tYWluXCI7XG5cbmV4cG9ydCBjbGFzcyBPbGxhbWFTdWdnZXN0b3IgZXh0ZW5kcyBFZGl0b3JTdWdnZXN0PHN0cmluZz4ge1xuXHRwbHVnaW46IE9sbGFtYVBsdWdpbjtcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBPbGxhbWFQbHVnaW4pIHtcblx0XHRzdXBlcihhcHApO1xuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xuXHR9XG5cblx0b25UcmlnZ2VyKGN1cnNvcjogRWRpdG9yUG9zaXRpb24sIGVkaXRvcjogRWRpdG9yLCBmaWxlOiBURmlsZSk6IEVkaXRvclN1Z2dlc3RUcmlnZ2VySW5mbyB8IG51bGwge1xuXHRcdGNvbnN0IGxpbmUgPSBlZGl0b3IuZ2V0TGluZShjdXJzb3IubGluZSkuc2xpY2UoMCwgY3Vyc29yLmNoKTtcblx0XHRpZiAobGluZS5lbmRzV2l0aCgnLycpKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRzdGFydDogeyBsaW5lOiBjdXJzb3IubGluZSwgY2g6IGN1cnNvci5jaCAtIDEgfSxcblx0XHRcdFx0ZW5kOiBjdXJzb3IsXG5cdFx0XHRcdHF1ZXJ5OiAnLydcblx0XHRcdH07XG5cdFx0fVxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0Z2V0U3VnZ2VzdGlvbnMoY29udGV4dDogRWRpdG9yU3VnZ2VzdENvbnRleHQpOiBzdHJpbmdbXSB7XG5cdFx0cmV0dXJuIFsnb2xsYW1hJ107XG5cdH1cblxuXHRyZW5kZXJTdWdnZXN0aW9uKHN1Z2dlc3Rpb246IHN0cmluZywgZWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XG5cdFx0ZWwuc2V0VGV4dChzdWdnZXN0aW9uKTtcblx0fVxuXG5cdHNlbGVjdFN1Z2dlc3Rpb24oc3VnZ2VzdGlvbjogc3RyaW5nKTogdm9pZCB7XG5cdFx0Y29uc3QgZWRpdG9yID0gdGhpcy5jb250ZXh0LmVkaXRvcjtcblx0XHRjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG5cdFx0ZWRpdG9yLnJlcGxhY2VSYW5nZShzdWdnZXN0aW9uICsgJyAnLCB7IGxpbmU6IGN1cnNvci5saW5lLCBjaDogY3Vyc29yLmNoIC0gMSB9LCBjdXJzb3IpO1xuXHR9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBPbGxhbWFQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcblxuZXhwb3J0IGNsYXNzIE9sbGFtYVByb21wdE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuXHRwbHVnaW46IE9sbGFtYVBsdWdpbjtcblx0cHJvbXB0SW5wdXQ6IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG5cdHJlc3BvbnNlT3V0cHV0OiBIVE1MRGl2RWxlbWVudDtcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBPbGxhbWFQbHVnaW4pIHtcblx0XHRzdXBlcihhcHApO1xuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xuXHR9XG5cblx0b25PcGVuKCkge1xuXHRcdGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXHRcdGNvbnRlbnRFbC5lbXB0eSgpO1xuXG5cdFx0Y29udGVudEVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ09sbGFtYSBQcm9tcHQnIH0pO1xuXG5cdFx0dGhpcy5wcm9tcHRJbnB1dCA9IGNvbnRlbnRFbC5jcmVhdGVFbCgndGV4dGFyZWEnLCB7XG5cdFx0XHRhdHRyOiB7IHJvd3M6ICc0JywgY29sczogJzUwJywgcGxhY2Vob2xkZXI6ICdFbnRlciB5b3VyIHByb21wdCBoZXJlJyB9XG5cdFx0fSk7XG5cblx0XHRjb250ZW50RWwuY3JlYXRlRWwoJ2JyJyk7XG5cblx0XHRjb25zdCBnZW5lcmF0ZUJ1dHRvbiA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnYnV0dG9uJywge1xuXHRcdFx0dGV4dDogJ0dlbmVyYXRlIFJlc3BvbnNlJyxcblx0XHRcdGF0dHI6IHsgc3R5bGU6ICdtYXJnaW4tdG9wOiAxMHB4OyBtYXJnaW4tYm90dG9tOiAxMHB4OycgfVxuXHRcdH0pO1xuXHRcdGdlbmVyYXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5nZW5lcmF0ZVJlc3BvbnNlLmJpbmQodGhpcykpO1xuXG5cdFx0dGhpcy5yZXNwb25zZU91dHB1dCA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICdvbGxhbWEtcmVzcG9uc2UnIH0pO1xuXHR9XG5cblx0YXN5bmMgZ2VuZXJhdGVSZXNwb25zZSgpIHtcblx0XHRjb25zdCBwcm9tcHQgPSB0aGlzLnByb21wdElucHV0LnZhbHVlO1xuXHRcdGlmIChwcm9tcHQpIHtcblx0XHRcdHRoaXMucmVzcG9uc2VPdXRwdXQuc2V0VGV4dCgnJyk7XG5cdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5nZW5lcmF0ZU9sbGFtYVJlc3BvbnNlKHByb21wdCwgKGNodW5rKSA9PiB7XG5cdFx0XHRcdHRoaXMucmVzcG9uc2VPdXRwdXQuc2V0VGV4dCh0aGlzLnJlc3BvbnNlT3V0cHV0LnRleHRDb250ZW50ICsgY2h1bmspO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0b25DbG9zZSgpIHtcblx0XHRjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcblx0XHRjb250ZW50RWwuZW1wdHkoKTtcblx0fVxufVxuIiwgImltcG9ydCB7XG5cdEFwcCxcblx0UGx1Z2luU2V0dGluZ1RhYixcblx0U2V0dGluZyxcblx0RHJvcGRvd25Db21wb25lbnQsXG5cdE5vdGljZVxufSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgT2xsYW1hUGx1Z2luIGZyb20gJy4vbWFpbic7XG5cbmV4cG9ydCBjbGFzcyBPbGxhbWFTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG5cdHBsdWdpbjogT2xsYW1hUGx1Z2luO1xuXHRtb2RlbERyb3Bkb3duOiBEcm9wZG93bkNvbXBvbmVudDtcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBPbGxhbWFQbHVnaW4pIHtcblx0XHRzdXBlcihhcHAsIHBsdWdpbik7XG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XG5cdH1cblxuXHRhc3luYyBkaXNwbGF5KCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ09sbGFtYSBVUkwnKVxuXHRcdFx0LnNldERlc2MoJ1RoZSBVUkwgb2YgeW91ciBsb2NhbCBPbGxhbWEgaW5zdGFuY2UnKVxuXHRcdFx0LmFkZFRleHQodGV4dCA9PiB0ZXh0XG5cdFx0XHRcdC5zZXRQbGFjZWhvbGRlcignRW50ZXIgdGhlIE9sbGFtYSBVUkwnKVxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hVXJsKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hVXJsID0gdmFsdWU7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0dGhpcy51cGRhdGVNb2RlbERyb3Bkb3duKCk7XG5cdFx0XHRcdH0pKTtcblxuXHRcdGNvbnN0IG1vZGVsU2V0dGluZyA9IG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ01vZGVsIE5hbWUnKVxuXHRcdFx0LnNldERlc2MoJ1RoZSBuYW1lIG9mIHRoZSBPbGxhbWEgbW9kZWwgdG8gdXNlJyk7XG5cblx0XHRtb2RlbFNldHRpbmcuYWRkRHJvcGRvd24oYXN5bmMgKGRyb3Bkb3duKSA9PiB7XG5cdFx0XHR0aGlzLm1vZGVsRHJvcGRvd24gPSBkcm9wZG93bjtcblx0XHRcdGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLmZldGNoT2xsYW1hTW9kZWxzKCk7XG5cdFx0XHRtb2RlbHMuZm9yRWFjaCgobW9kZWwpID0+IHtcblx0XHRcdFx0ZHJvcGRvd24uYWRkT3B0aW9uKG1vZGVsLCBtb2RlbCk7XG5cdFx0XHR9KTtcblx0XHRcdGRyb3Bkb3duLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm1vZGVsTmFtZSk7XG5cdFx0XHRkcm9wZG93bi5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcblx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MubW9kZWxOYW1lID0gdmFsdWU7XG5cdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdSZWZyZXNoIE1vZGVscycpXG5cdFx0XHQuc2V0RGVzYygnRmV0Y2ggdGhlIGxhdGVzdCBsaXN0IG9mIG1vZGVscyBmcm9tIE9sbGFtYScpXG5cdFx0XHQuYWRkQnV0dG9uKChidXR0b24pID0+IHtcblx0XHRcdFx0YnV0dG9uLnNldEJ1dHRvblRleHQoJ1JlZnJlc2gnKVxuXHRcdFx0XHRcdC5vbkNsaWNrKGFzeW5jICgpID0+IHtcblx0XHRcdFx0XHRcdGF3YWl0IHRoaXMudXBkYXRlTW9kZWxEcm9wZG93bigpO1xuXHRcdFx0XHRcdFx0bmV3IE5vdGljZSgnTW9kZWxzIHJlZnJlc2hlZCcpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdH1cblxuXHRhc3luYyB1cGRhdGVNb2RlbERyb3Bkb3duKCkge1xuXHRcdGNvbnN0IG1vZGVscyA9IGF3YWl0IHRoaXMucGx1Z2luLmZldGNoT2xsYW1hTW9kZWxzKCk7XG5cdFx0dGhpcy5tb2RlbERyb3Bkb3duLmNsZWFyKCk7XG5cdFx0bW9kZWxzLmZvckVhY2goKG1vZGVsKSA9PiB7XG5cdFx0XHR0aGlzLm1vZGVsRHJvcGRvd24uYWRkT3B0aW9uKG1vZGVsLCBtb2RlbCk7XG5cdFx0fSk7XG5cdFx0aWYgKG1vZGVscy5pbmNsdWRlcyh0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbE5hbWUpKSB7XG5cdFx0XHR0aGlzLm1vZGVsRHJvcGRvd24uc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubW9kZWxOYW1lKTtcblx0XHR9IGVsc2UgaWYgKG1vZGVscy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbE5hbWUgPSBtb2RlbHNbMF07XG5cdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHR9XG5cdFx0dGhpcy5tb2RlbERyb3Bkb3duLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MubW9kZWxOYW1lID0gdmFsdWU7XG5cdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHR9KTtcblx0fVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBQUFBLG1CQUtPOzs7QUNIQSxJQUFNLGdCQUFOLE1BQW9CO0FBQUEsRUFDMUIsWUFBb0IsVUFBZ0M7QUFBaEM7QUFBQSxFQUFpQztBQUFBLEVBRXJELE1BQU0saUJBQWlCLFFBQWdCLFNBQWlEO0FBTHpGO0FBTUUsUUFBSTtBQUNILFlBQU0sV0FBVyxNQUFNLE1BQU0sR0FBRyxLQUFLLFNBQVMsMEJBQTBCO0FBQUEsUUFDdkUsUUFBUTtBQUFBLFFBQ1IsU0FBUztBQUFBLFVBQ1IsZ0JBQWdCO0FBQUEsUUFDakI7QUFBQSxRQUNBLE1BQU0sS0FBSyxVQUFVO0FBQUEsVUFDcEIsU0FBUyxLQUFLLFNBQVM7QUFBQSxVQUN2QixVQUFVO0FBQUEsVUFDVixVQUFVO0FBQUEsUUFDWCxDQUFDO0FBQUEsTUFDRixDQUFDO0FBRUQsVUFBSSxDQUFDLFNBQVMsSUFBSTtBQUNqQixjQUFNLElBQUksTUFBTSx1QkFBdUIsU0FBUyxRQUFRO0FBQUEsTUFDekQ7QUFFQSxZQUFNLFVBQVMsY0FBUyxTQUFULG1CQUFlO0FBQzlCLFVBQUksQ0FBQyxRQUFRO0FBQ1osY0FBTSxJQUFJLE1BQU0sK0JBQStCO0FBQUEsTUFDaEQ7QUFFQSxZQUFNLFVBQVUsSUFB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
